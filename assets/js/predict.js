"use strict";function _slicedToArray(t,n){return _arrayWithHoles(t)||_iterableToArrayLimit(t,n)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(t,n){var e=[],o=!0,r=!1,i=void 0;try{for(var l,a=t[Symbol.iterator]();!(o=(l=a.next()).done)&&(e.push(l.value),!n||e.length!==n);o=!0);}catch(t){r=!0,i=t}finally{try{o||null==a.return||a.return()}finally{if(r)throw i}}return e}function _arrayWithHoles(t){if(Array.isArray(t))return t}function init(){$("#info, #loadding, #loadErr, #invalid, #plot, #mgf").removeClass("hidden").slideUp(0),$("select").select2({dropdownCssClass:"dropdown-inverse"}),$(".input-group").on("focus",".form-control",function(){return $(this).closest(".input-group, .form-group").addClass("focus")}).on("blur",".form-control",function(){return $(this).closest(".input-group, .form-group").removeClass("focus")}),$(".btn-group").on("click","a",function(){return $(this).siblings().removeClass("active").end().addClass("active")})}function mgf(t,n,e,o,r,i){for(var l="BEGIN IONS\nTitle=".concat(e,"\nCHARGE=").concat(n,"+\nPEPMASS=").concat(o,"\n"),a=0;a<r.length;a++)l+=r[a].toFixed(2)+"\t"+i[a].toFixed(5)+"\n";return l+"END IONS"}var types={2:"ETD",3:"HCD"};function show_result(t,n,e,o){var r=_slicedToArray(t,3),i=r[0],l=r[1],a=r[2];$("#mgf_box").html(mgf(n,e,o,i,l,a)),$("#rst").html('<div id="sp"></div>'),Plotly.newPlot("sp",[{x:l,y:a,type:"bar"}],{title:{text:"Prediction of ".concat(o,", charge ").concat(e,"+, ").concat(types[n])},xaxis:{range:[130,l[l.length-1]+50],title:{text:"M/z"}}})}function get(n,e,o){jQuery.getJSON("/json/".concat(n,"/").concat(e,"/").concat(o,"?id=").concat((new Date).valueOf()),function(t){$("#loadding").slideUp(400),$("#info").slideDown(400),$("#plot").slideDown(400),$("#mgf").slideDown(400),setTimeout(function(){$("#info").slideUp(400)},1500),$("body, html").animate({scrollTop:$("#info")[0].offsetTop-300},1e3),show_result(t,n,e,o)}).fail(function(t){$("#loadding").slideUp(400),$("#loadErr").slideDown(400)})}var charMap={A:1,R:2,N:3,D:3,C:5,E:5,Q:7,G:8,H:9,I:10,L:11,K:12,M:13,F:14,P:15,S:16,T:17,W:18,Y:19,V:20};function invalid(t){if(22<(t=t.toUpperCase()).length)return!0;var n=!0,e=!1,o=void 0;try{for(var r,i=t[Symbol.iterator]();!(n=(r=i.next()).done);n=!0){var l=r.value;if(!charMap.hasOwnProperty(l))return!0}}catch(t){e=!0,o=t}finally{try{n||null==i.return||i.return()}finally{if(e)throw o}}return!1}function doSearch(){if(invalid($("#peptide").val()))return $("#info").slideUp(400),$("#loadding").slideUp(400),$("#loadErr").slideUp(400),void $("#invalid").slideDown(400);$("#info").slideUp(400),$("#loadErr").slideUp(400),$("#invalid").slideUp(400),$("#plot").slideUp(400),$("#mgf").slideUp(400),$("#loadding").slideDown(400),get($("#type").val(),$("#charge").val(),$("#peptide").val().toUpperCase())}init(),$("#search").on("click",function(t){return doSearch()}),$("#peptide").focus().on("keydown",function(t){if(13===t.which)return doSearch()});